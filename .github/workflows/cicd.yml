name: 'Terraform Git Action - Liz'

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]



# Use the Bash shell regardless whether the GitHub Actions runner is ubuntu-latest, macos-latest, or winddows-latest
defaults:
  run:
    shell: bash
jobs:
  s3_sync:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - name: hmm
        uses: actions/checkout@v3
      - name: PWD
        run: pwd && ls
      # - name: LS
      #   run: cd ../../.. && ls && pwd
      - name: Configure AWS credentials from Account
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-region: us-east-1
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          role-to-assume: ${{ secrets.AWS_ROLE_TO_ASSUME }}
          # role-external-id:a ${{ secrets.AWSd_ROLE_EXTERNAL_ID }}
          role-duration-seconds: 1200
          # role-session-name: Sync-2-S3dd

        # run: cd .. && ls
      - name: Sync files to S3
        run: aws s3 sync . s3://ar-portfolio-v1
        # with:
        #   args: --acl public-read --follow-symlinks --delete --exclude '.git/*' --exclude '.github/*'
 
  start_node_server:
    runs-on: ubuntu-latest
    steps:
      - name: docker build
        run: docker build -t egma34y/3d-portfolio:0.0.0.RELEASE .
      - name: docker run 
        run: docker container run -d -p 3000:3000 egma34y/3d-portfolio:0.0.0.RELEASE
  

